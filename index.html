<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Markdown</title>
    <!-- libs -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>

    <!-- Kontent Custom elements API-->
    <script src="https://app.devkontentmasters.com/js-api/custom-element/v1/custom-element.js"></script>

    <link rel="stylesheet" href="css/focuspoint.css">
    <script src="js/jquery.focuspoint.min.js"></script>
    <script src="js/jquery.focuspoint.helpertool.js"></script>

    <!-- Custom elements styles -->
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <!-- Custom element HTML -->
    <div class="helper-tool-target">
        <img class="helper-tool-img">
        <img class="reticle" height="300" id="image_url_src" src="img/city_from_unsplash.jpg">
        <img class="target-overlay">
    </div>
    <input type=text id="image_url"></textarea>
    <button id="select_asset">Select asset</button>

    <!-- Custom element code -->
    <script>
        initCustomElement();
        var isDisabled = false;

        function updateDisabled(disabled) {
            if (disabled) {
                $(".disabled_overlay").show();
            }
            else {
                $(".disabled_overlay").hide();
            }
            updateSize();
            isDisabled = disabled;
        }

        function setup(value) {
            $("#select_asset").click(function (e) {
                insertImage();
            });
            updateSize();
        }

        function updateSize() {
            // Updates the custom element height in the Kontent UI
            const height = Math.ceil($("html").height());
            CustomElement.setHeight(height);
        }

        function setValue(value) {
            // Sends updated value to Kontent (if the editor is empty, will send null  so the element won't meet a required condition).
            if (!isDisabled) {
                CustomElement.setValue(value || null);
            }
        }

        function initCustomElement() {
            try {
                CustomElement.init((element, _context) => {
                    setup(element.value);
                    updateSize();
                });

                // Reacts to changes in disabling (e.g., when publishing the item)
                CustomElement.onDisabledChanged(updateDisabled);
            } catch (err) {
                // Sends message to console and editor if initialization failed (for example, if the page is displayed outside the Kontent UI)
                console.error(err);
            }
        }

        async function insertImage() {
            // Opens an asset selection dialog in Kontent
            const assets = await CustomElement.selectAssets({
                allowMultiple: false,
                fileType: 'images'
            });
            // Gets an ID of the first selected asset
            const assetId = assets[0].id;
            // Retrieves details of the asset specified by its ID
            const assetDetails = await CustomElement.getAssetDetails([assetId]);

            $("#image_url").val(assetDetails[0].url)
            $("#image_url_src").attr("src",assetDetails[0].url);            
        }
    </script>
</body>

</html>